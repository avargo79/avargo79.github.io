import{aa as r,ua as o}from"./chunk-IQ6ZNRPZ.js";var s=class a{verificationListeners=new Map;stepStates=o(new Map);verificationEvents=o([]);registerStepVerification(t,e){this.verificationListeners.set(t,e),this.updateStepState(t,"pending")}unregisterStepVerification(t){this.verificationListeners.delete(t)}activateStep(t){this.updateStepState(t,"active")}emitEvent(t,e){let n={type:t,payload:e,timestamp:Date.now()};this.verificationEvents.update(i=>[...i,n]);for(let[i,p]of this.verificationListeners.entries())this.getStepState(i)==="active"&&this.checkVerification(p,n)&&(this.updateStepState(i,"verifying"),setTimeout(()=>{this.completeStep(i)},100))}checkVerification(t,e){if(t.type==="custom"&&t.condition)return t.condition(e);if(t.type!==e.type)return!1;if(t.target&&typeof e.payload=="object"&&e.payload!==null){let n=e.payload;if((n.target||n.name||n.id)!==t.target)return!1}return t.condition?t.condition(e.payload):!0}completeStep(t){this.updateStepState(t,"completed")}skipStep(t){this.updateStepState(t,"skipped")}resetStep(t){this.updateStepState(t,"pending")}getStepState(t){return this.stepStates().get(t)||"pending"}updateStepState(t,e){this.stepStates.update(n=>{let i=new Map(n);return i.set(t,e),i})}clearHistory(){this.verificationEvents.set([])}getEventHistory(){return this.verificationEvents()}static \u0275fac=function(e){return new(e||a)};static \u0275prov=r({token:a,factory:a.\u0275fac,providedIn:"root"})};export{s as a};
