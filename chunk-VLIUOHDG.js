import{c as Ce,f as ve,g as ye,i as O}from"./chunk-C6CP4LLD.js";import{a as R}from"./chunk-YOKPIRUX.js";import{a as ge}from"./chunk-EC5LA6IH.js";import{Ab as se,Cb as ie,Db as _,Eb as D,Fb as ae,Jb as ce,Ka as b,Kb as me,Lb as de,Tb as M,Wa as Y,a as x,aa as g,b as S,c as f,da as w,ea as p,eb as J,fb as Z,gb as ee,hc as le,ib as te,jb as re,ka as A,la as $,lb as P,lc as I,mb as k,mc as ue,nb as ne,nc as pe,qc as he,sb as oe,sc as fe,ua as v,ub as q,wb as G,xb as K,yb as X,zb as Q}from"./chunk-IQ6ZNRPZ.js";var T=class m{parse(e){let t=e.trim();if(!t)throw new Error("Empty command");return t.includes("|")?this.parsePipedCommands(t):this.parseSingleCommand(t)}parseSingleCommand(e){let t=e,n,r=!1,s=t.match(/\s*>>\s*(.+)$/);if(s)n=s[1].trim(),r=!0,t=t.substring(0,s.index);else{let i=t.match(/\s*>\s*(.+)$/);i&&(n=i[1].trim(),t=t.substring(0,i.index))}let o=this.tokenize(t.trim());if(o.length===0)throw new Error("Empty command");return{command:o[0],args:o.slice(1),rawInput:e,redirectOutput:n,redirectAppend:r}}parsePipedCommands(e){let t=this.splitByPipes(e);if(t.length===0)throw new Error("Empty command");let n=this.parseSingleCommand(t[0]),r=t.slice(1).map(s=>this.parseSingleCommand(s));return S(x({},n),{pipes:r})}splitByPipes(e){let t=[],n="",r=!1,s=!1,o=!1;for(let i=0;i<e.length;i++){let a=e[i];if(o){n+=a,o=!1;continue}if(a==="\\"){o=!0;continue}if(a==="'"&&!s){r=!r,n+=a;continue}if(a==='"'&&!r){s=!s,n+=a;continue}if(a==="|"&&!r&&!s){t.push(n.trim()),n="";continue}n+=a}return n.trim()&&t.push(n.trim()),t}tokenize(e){let t=[],n="",r=!1,s=!1,o=!1;for(let i=0;i<e.length;i++){let a=e[i];if(o){n+=a,o=!1;continue}if(a==="\\"){o=!0;continue}if(a==="'"&&!s){r=!r;continue}if(a==='"'&&!r){s=!s;continue}if(a===" "&&!r&&!s){n&&(t.push(n),n="");continue}n+=a}return n&&t.push(n),t}static \u0275fac=function(t){return new(t||m)};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var y=class m{constructor(e){this.parser=e}commands=new Map;missionService=p(O);registerCommand(e,t){this.commands.set(e,t)}unregisterCommand(e){this.commands.delete(e)}getRegisteredCommands(){return Array.from(this.commands.keys()).sort()}hasCommand(e){return this.commands.has(e)}execute(e,t){return f(this,null,function*(){try{let n=this.parser.parse(e);return yield this.executeParsed(n,t)}catch(n){return{output:"",exitCode:1,error:n instanceof Error?n.message:String(n)}}})}executeParsed(e,t){return f(this,null,function*(){return e.pipes&&e.pipes.length>0?yield this.executePipeline(e,t):yield this.executeSingleCommand(e,t)})}executeSingleCommand(e,t){return f(this,null,function*(){let n=this.commands.get(e.command);if(!n)return{output:"",exitCode:127,error:`Command not found: ${e.command}`};try{let r=yield n(e.args,t);return r.exitCode===0&&this.checkMissionObjectives(e.command,e.args,r),e.redirectOutput?{output:`Output redirected to ${e.redirectOutput}`,exitCode:r.exitCode,error:r.error}:r}catch(r){return{output:"",exitCode:1,error:r instanceof Error?r.message:String(r)}}})}checkMissionObjectives(e,t,n){let r=this.extractMissionData(e,t,n);r.success&&this.missionService.checkObjectiveCompletion(e,t,r)}extractMissionData(e,t,n){if(n.exitCode!==0)return{success:!1};let r={success:!0};if(t.length>0&&(r.target=t[0]),t.length>1&&["download","upload","rm"].includes(e)&&(r.targetFile=t[1]),e==="exploit"&&n.output.includes("backdoor")&&(r.data={backdoor:!0}),e==="transfer"&&t.length>1){let s=parseInt(t[1],10);isNaN(s)||(r.data={amount:s})}return r}executePipeline(e,t){return f(this,null,function*(){let n="",r=0,s=yield this.executeSingleCommand(e,t);if(n=s.output,r=s.exitCode,r!==0)return s;for(let o of e.pipes||[]){let i=this.commands.get(o.command);if(!i)return{output:"",exitCode:127,error:`Command not found: ${o.command}`};try{let a=S(x({},t),{environment:S(x({},t.environment),{PIPE_INPUT:n})}),c=yield i(o.args,a);if(n=c.output,r=c.exitCode,r!==0)return c}catch(a){return{output:"",exitCode:1,error:a instanceof Error?a.message:String(a)}}}return{output:n,exitCode:r}})}static \u0275fac=function(t){return new(t||m)(w(T))};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var N=class m{constructor(e,t){this.executor=e;this.fs=t;this.registerCommands()}missionService=p(O);registerCommands(){this.executor.registerCommand("ls",(e,t)=>this.ls(e,t)),this.executor.registerCommand("cd",(e,t)=>this.cd(e,t)),this.executor.registerCommand("pwd",(e,t)=>this.pwd(e,t)),this.executor.registerCommand("cat",(e,t)=>this.cat(e,t)),this.executor.registerCommand("echo",(e,t)=>this.echo(e,t)),this.executor.registerCommand("mkdir",(e,t)=>this.mkdir(e,t)),this.executor.registerCommand("touch",(e,t)=>this.touch(e,t)),this.executor.registerCommand("rm",(e,t)=>this.rm(e,t)),this.executor.registerCommand("cp",(e,t)=>this.cp(e,t)),this.executor.registerCommand("mv",(e,t)=>this.mv(e,t)),this.executor.registerCommand("clear",(e,t)=>this.clear(e,t)),this.executor.registerCommand("whoami",(e,t)=>this.whoami(e,t)),this.executor.registerCommand("hostname",(e,t)=>this.hostname(e,t)),this.executor.registerCommand("date",(e,t)=>this.date(e,t)),this.executor.registerCommand("grep",(e,t)=>this.grep(e,t)),this.executor.registerCommand("wc",(e,t)=>this.wc(e,t)),this.executor.registerCommand("uname",(e,t)=>this.uname(e,t))}ls(e,t){let n=e.includes("-a"),r=e.includes("-l"),s=e.find(c=>!c.startsWith("-"))||t.currentDirectory,o=this.fs.resolvePath(s,t.currentDirectory),i=this.fs.listDirectory(o);if(i===null)return{output:"",exitCode:1,error:`ls: cannot access '${s}': No such file or directory`};let a="";if(r)for(let c of i){let d=c.type==="directory"?"d":"-",C=c.modified.toLocaleDateString(),l=c.modified.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});a+=`${d}${c.permissions} ${c.owner} ${c.group} ${c.size.toString().padStart(8)} ${C} ${l} ${c.name}
`}else a=i.map(d=>d.name).join("  ")+`
`;return{output:a,exitCode:0}}cd(e,t){if(e.length===0)return{output:"CD:/home/user",exitCode:0};let n=e[0],r=this.fs.resolvePath(n,t.currentDirectory);return this.fs.exists(r)?this.fs.isDirectory(r)?{output:`CD:${r}`,exitCode:0}:{output:"",exitCode:1,error:`cd: ${n}: Not a directory`}:{output:"",exitCode:1,error:`cd: ${n}: No such file or directory`}}pwd(e,t){return{output:t.currentDirectory,exitCode:0}}cat(e,t){if(e.length===0)return{output:"",exitCode:1,error:"cat: missing file operand"};let n=[];for(let r of e){let s=this.fs.resolvePath(r,t.currentDirectory),o=this.fs.readFile(s);if(o===null)return{output:"",exitCode:1,error:`cat: ${r}: No such file or directory`};n.push(o)}return{output:n.join(""),exitCode:0}}echo(e,t){return{output:e.join(" "),exitCode:0}}mkdir(e,t){if(e.length===0)return{output:"",exitCode:1,error:"mkdir: missing operand"};for(let n of e){let r=this.fs.resolvePath(n,t.currentDirectory);if(!this.fs.createDirectory(r,t.user,t.user))return{output:"",exitCode:1,error:`mkdir: cannot create directory '${n}': File exists or parent directory does not exist`}}return{output:"",exitCode:0}}touch(e,t){if(e.length===0)return{output:"",exitCode:1,error:"touch: missing file operand"};for(let n of e){let r=this.fs.resolvePath(n,t.currentDirectory);if(!this.fs.exists(r)&&!this.fs.writeFile(r,"",t.user,t.user))return{output:"",exitCode:1,error:`touch: cannot touch '${n}': No such file or directory`}}return{output:"",exitCode:0}}rm(e,t){let n=e.includes("-r")||e.includes("-rf"),r=e.filter(o=>!o.startsWith("-")),s=[];if(r.length===0)return{output:"",exitCode:1,error:"rm: missing operand"};for(let o of r){let i=this.fs.resolvePath(o,t.currentDirectory);if(!this.fs.exists(i))return{output:"",exitCode:1,error:`rm: cannot remove '${o}': No such file or directory`};if(this.fs.isDirectory(i)&&!n)return{output:"",exitCode:1,error:`rm: cannot remove '${o}': Is a directory`};if(!this.fs.deleteNode(i))return{output:"",exitCode:1,error:`rm: cannot remove '${o}'`};let a=this.missionService.checkObjectiveCompletion("rm",[o],{success:!0,data:{path:i,file:o}});a.message&&s.push(a.message)}return{output:s.join(`
`),exitCode:0}}cp(e,t){if(e.length<2)return{output:"",exitCode:1,error:"cp: missing file operand"};let n=e[0],r=e[1],s=this.fs.resolvePath(n,t.currentDirectory),o=this.fs.resolvePath(r,t.currentDirectory);return this.fs.exists(s)?this.fs.copyNode(s,o)?{output:"",exitCode:0}:{output:"",exitCode:1,error:`cp: cannot copy '${n}' to '${r}'`}:{output:"",exitCode:1,error:`cp: cannot stat '${n}': No such file or directory`}}mv(e,t){if(e.length<2)return{output:"",exitCode:1,error:"mv: missing file operand"};let n=e[0],r=e[1],s=this.fs.resolvePath(n,t.currentDirectory),o=this.fs.resolvePath(r,t.currentDirectory);return this.fs.exists(s)?this.fs.moveNode(s,o)?{output:"",exitCode:0}:{output:"",exitCode:1,error:`mv: cannot move '${n}' to '${r}'`}:{output:"",exitCode:1,error:`mv: cannot stat '${n}': No such file or directory`}}clear(e,t){return{output:"CLEAR",exitCode:0}}whoami(e,t){return{output:t.user,exitCode:0}}hostname(e,t){return{output:t.hostname,exitCode:0}}date(e,t){return{output:new Date().toString(),exitCode:0}}grep(e,t){if(e.length===0)return{output:"",exitCode:1,error:"grep: missing pattern or file"};let n=e[0],s=t.environment.PIPE_INPUT;if(!s){if(e.length<2)return{output:"",exitCode:1,error:"grep: missing pattern or file"};let i=this.fs.resolvePath(e[1],t.currentDirectory);if(s=this.fs.readFile(i),s===null)return{output:"",exitCode:1,error:`grep: ${e[1]}: No such file or directory`}}return{output:s.split(`
`).filter(i=>i.includes(n)).join(`
`),exitCode:0}}wc(e,t){let r=t.environment.PIPE_INPUT;if(!r){if(e.length===0)return{output:"",exitCode:1,error:"wc: missing file operand"};let a=this.fs.resolvePath(e[0],t.currentDirectory);if(r=this.fs.readFile(a),r===null)return{output:"",exitCode:1,error:`wc: ${e[0]}: No such file or directory`}}let s=r.split(`
`).length,o=r.split(/\s+/).filter(a=>a.length>0).length,i=r.length;return{output:`${s} ${o} ${i}`,exitCode:0}}uname(e,t){return{output:"WebOS 1.0.0 (x86_64)",exitCode:0}}static \u0275fac=function(t){return new(t||m)(w(y),w(I))};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var U=class m{economyService=p(Ce);notificationService=p(ge);missionService=p(O);playerUpgrades=v({});UPGRADES=[{id:"cpu_1",name:"CPU Upgrade Mk1",description:"Increases hacking speed by 25%",category:"hardware",type:"cpu",baseCost:2e3,currentLevel:0,maxLevel:5,effects:[{stat:"hackingSpeed",modifier:.25,type:"multiplicative"}]},{id:"cpu_2",name:"CPU Upgrade Mk2",description:"Further increases hacking speed by 50%",category:"hardware",type:"cpu",baseCost:8e3,currentLevel:0,maxLevel:5,effects:[{stat:"hackingSpeed",modifier:.5,type:"multiplicative"}],requirements:{otherUpgrades:[{id:"cpu_1",minLevel:3}]}},{id:"ram_1",name:"RAM Upgrade Mk1",description:"Increases script capacity by 50%",category:"hardware",type:"ram",baseCost:1500,currentLevel:0,maxLevel:10,effects:[{stat:"scriptCapacity",modifier:.5,type:"multiplicative"}]},{id:"bandwidth_1",name:"Bandwidth Upgrade Mk1",description:"Increases data transfer speed by 30%",category:"hardware",type:"bandwidth",baseCost:3e3,currentLevel:0,maxLevel:5,effects:[{stat:"transferSpeed",modifier:.3,type:"multiplicative"}]},{id:"storage_1",name:"Storage Upgrade Mk1",description:"Increases storage capacity by 100GB",category:"hardware",type:"storage",baseCost:1e3,currentLevel:0,maxLevel:20,effects:[{stat:"storageCapacity",modifier:100,type:"additive"}]},{id:"firewall_1",name:"Firewall Software Mk1",description:"Increases trace resistance by 20%",category:"software",type:"firewall",baseCost:2500,currentLevel:0,maxLevel:5,effects:[{stat:"traceResistance",modifier:.2,type:"multiplicative"}]},{id:"firewall_2",name:"Firewall Software Mk2",description:"Advanced firewall with 40% trace resistance",category:"software",type:"firewall",baseCost:1e4,currentLevel:0,maxLevel:5,effects:[{stat:"traceResistance",modifier:.4,type:"multiplicative"}],requirements:{otherUpgrades:[{id:"firewall_1",minLevel:3}]}},{id:"encryption_1",name:"Encryption Suite Mk1",description:"Improves data security by 25%",category:"software",type:"encryption",baseCost:3500,currentLevel:0,maxLevel:5,effects:[{stat:"dataSecurity",modifier:.25,type:"multiplicative"}]},{id:"trace_killer_1",name:"Trace Killer Tool",description:"Reduces trace buildup by 30%",category:"tools",type:"trace_killer",baseCost:5e3,currentLevel:0,maxLevel:3,effects:[{stat:"traceReduction",modifier:.3,type:"multiplicative"}]},{id:"port_scanner_1",name:"Advanced Port Scanner",description:"Faster port scanning, reveals more information",category:"tools",type:"port_scanner",baseCost:1800,currentLevel:0,maxLevel:5,effects:[{stat:"scanSpeed",modifier:.4,type:"multiplicative"},{stat:"scanDepth",modifier:1,type:"additive"}]},{id:"password_cracker_1",name:"Password Cracker Pro",description:"Increases password cracking speed by 50%",category:"tools",type:"password_cracker",baseCost:4e3,currentLevel:0,maxLevel:5,effects:[{stat:"crackSpeed",modifier:.5,type:"multiplicative"}]},{id:"exploit_kit_1",name:"Exploit Development Kit",description:"Increases exploit effectiveness by 35%",category:"tools",type:"exploit_kit",baseCost:6e3,currentLevel:0,maxLevel:5,effects:[{stat:"exploitPower",modifier:.35,type:"multiplicative"}],requirements:{level:5}},{id:"log_cleaner_1",name:"Log Cleaning Utility",description:"Automatically cleans logs, reduces detection by 25%",category:"tools",type:"log_cleaner",baseCost:3e3,currentLevel:0,maxLevel:5,effects:[{stat:"detectionReduction",modifier:.25,type:"multiplicative"}]},{id:"backdoor_tool_1",name:"Backdoor Creation Tool",description:"Enables creation of persistent backdoors",category:"tools",type:"backdoor_tool",baseCost:7500,currentLevel:0,maxLevel:3,effects:[{stat:"backdoorDuration",modifier:1.5,type:"multiplicative"}],requirements:{level:10}},{id:"bitcoin_miner_1",name:"Bitcoin Miner Mk1",description:"Generates $5 per second",category:"passive_income",type:"bitcoin_miner",baseCost:1e6,currentLevel:0,maxLevel:5,effects:[{stat:"passiveIncome",modifier:1,type:"additive"}],requirements:{level:15}},{id:"bitcoin_miner_2",name:"Bitcoin Miner Mk2",description:"Generates $20 per second",category:"passive_income",type:"bitcoin_miner",baseCost:1e7,currentLevel:0,maxLevel:3,effects:[{stat:"passiveIncome",modifier:5,type:"additive"}],requirements:{level:25,otherUpgrades:[{id:"bitcoin_miner_1",minLevel:5}]}},{id:"botnet_1",name:"Small Botnet",description:"Network of 100 bots generates $2 per second",category:"passive_income",type:"botnet",baseCost:5e5,currentLevel:0,maxLevel:5,effects:[{stat:"passiveIncome",modifier:.5,type:"additive"}],requirements:{level:10}},{id:"botnet_2",name:"Medium Botnet",description:"Network of 1000 bots generates $10 per second",category:"passive_income",type:"botnet",baseCost:5e6,currentLevel:0,maxLevel:3,effects:[{stat:"passiveIncome",modifier:2,type:"additive"}],requirements:{level:20,otherUpgrades:[{id:"botnet_1",minLevel:10}]}},{id:"botnet_3",name:"Large Botnet",description:"Network of 10000 bots generates $50 per second",category:"passive_income",type:"botnet",baseCost:25e6,currentLevel:0,maxLevel:2,effects:[{stat:"passiveIncome",modifier:10,type:"additive"}],requirements:{level:35,otherUpgrades:[{id:"botnet_2",minLevel:10}]}}];constructor(){this.loadPlayerUpgrades()}get playerUpgrades$(){return this.playerUpgrades.asReadonly()}getShopItems(){let e=this.missionService.getPlayerLevel(),t=this.playerUpgrades();return this.UPGRADES.map(n=>{let r=t[n.id]||0,s=this.calculateUpgradeCost(n,r),o=this.economyService.canAfford(s),{canPurchase:i,lockReason:a}=this.checkRequirements(n,r,e,t);return S(x({},n),{currentLevel:r,cost:s,canAfford:o,canPurchase:i,locked:!i,lockReason:a})})}getShopItemsByCategory(e){return this.getShopItems().filter(t=>t.category===e)}getUpgradeLevel(e){return this.playerUpgrades()[e]||0}getUpgrade(e){return this.UPGRADES.find(t=>t.id===e)}purchaseUpgrade(e){let t=this.getUpgrade(e);if(!t)return{success:!1,error:"Upgrade not found"};let n=this.getUpgradeLevel(e);if(n>=t.maxLevel)return{success:!1,error:"Upgrade already at max level"};if(t.category==="passive_income"){let C=this.economyService.getPassiveIncomeRate(),l=t.effects.find(u=>u.stat==="passiveIncome")?.modifier||0;if(C+l>15)return{success:!1,error:"Purchase would exceed passive income cap ($15/sec)"}}let r=this.calculateUpgradeCost(t,n),s=this.missionService.getPlayerLevel(),o=this.playerUpgrades(),{canPurchase:i,lockReason:a}=this.checkRequirements(t,n,s,o);if(!i)return{success:!1,error:a||"Cannot purchase this upgrade"};let c=this.economyService.purchase(r,t.name,{upgradeId:e,level:n+1});if(!c.success)return{success:!1,error:c.error};let d=n+1;return this.playerUpgrades.update(C=>S(x({},C),{[e]:d})),this.savePlayerUpgrades(),this.updatePassiveIncome(),this.notificationService.success("Upgrade Purchased",`${t.name} upgraded to level ${d}`),{success:!0,upgrade:t,newLevel:d}}getPlayerStats(){let e=this.playerUpgrades(),t={hackingSpeed:1,scriptCapacity:1,transferSpeed:1,storageCapacity:100,traceResistance:0,dataSecurity:0,traceReduction:0,scanSpeed:1,scanDepth:1,crackSpeed:1,exploitPower:1,detectionReduction:0,backdoorDuration:1,passiveIncome:0};for(let n in e){let r=e[n],s=this.getUpgrade(n);if(!(!s||r===0))for(let o of s.effects){let i=o.modifier*r;switch(o.type){case"additive":t[o.stat]=(t[o.stat]||0)+i;break;case"multiplicative":t[o.stat]=(t[o.stat]||1)*(1+i);break;case"absolute":t[o.stat]=i;break}}}return t}resetUpgrades(){this.playerUpgrades.set({}),this.savePlayerUpgrades(),this.updatePassiveIncome()}updatePassiveIncome(){let t=this.getPlayerStats().passiveIncome||0;this.economyService.setPassiveIncomeRate(t)}calculateUpgradeCost(e,t){return Math.floor(e.baseCost*Math.pow(1.5,t))}checkRequirements(e,t,n,r){if(t>=e.maxLevel)return{canPurchase:!1,lockReason:"Max level reached"};if(e.requirements?.level&&n<e.requirements.level)return{canPurchase:!1,lockReason:`Requires player level ${e.requirements.level}`};if(e.requirements?.otherUpgrades){for(let s of e.requirements.otherUpgrades)if((r[s.id]||0)<s.minLevel)return{canPurchase:!1,lockReason:`Requires ${this.getUpgrade(s.id)?.name} level ${s.minLevel}`}}return{canPurchase:!0}}savePlayerUpgrades(){try{localStorage.setItem("webos_player_upgrades",JSON.stringify(this.playerUpgrades()))}catch(e){console.error("Failed to save player upgrades:",e)}}loadPlayerUpgrades(){try{let e=localStorage.getItem("webos_player_upgrades");if(e){let t=JSON.parse(e);this.playerUpgrades.set(t)}}catch(e){console.error("Failed to load player upgrades:",e)}}static \u0275fac=function(t){return new(t||m)};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var F=class m{executor=p(y);networkService=p(ve);shopService=p(U);fileSystem=p(I);missionService=p(O);verificationService=p(R);constructor(){this.registerCommands()}registerCommands(){this.executor.registerCommand("scan",(e,t)=>this.scan(e,t)),this.executor.registerCommand("nmap",(e,t)=>this.scan(e,t)),this.executor.registerCommand("probe",(e,t)=>this.probe(e,t)),this.executor.registerCommand("ssh",(e,t)=>this.connect(e,t)),this.executor.registerCommand("connect",(e,t)=>this.connect(e,t)),this.executor.registerCommand("disconnect",(e,t)=>this.disconnect(e,t)),this.executor.registerCommand("crack",(e,t)=>this.crack(e,t)),this.executor.registerCommand("exploit",(e,t)=>this.exploit(e,t)),this.executor.registerCommand("upload",(e,t)=>this.upload(e,t)),this.executor.registerCommand("download",(e,t)=>this.download(e,t)),this.executor.registerCommand("bounce",(e,t)=>this.bounce(e,t)),this.executor.registerCommand("trace",(e,t)=>this.trace(e,t)),this.executor.registerCommand("sysinfo",(e,t)=>this.sysinfo(e,t)),this.executor.registerCommand("transfer",(e,t)=>this.transfer(e,t))}scan(e,t){return f(this,null,function*(){let n=this.shopService.getPlayerStats(),r=n.scanSpeed||1,s=Math.floor(n.scanDepth||1);if(e.length===0){let h=this.networkService.getNetworkState().hosts.filter(E=>E.isDiscovered&&E.ip!=="127.0.0.1");return h.length===0?{output:`Scanning local network...

No hosts discovered yet. Try: nmap 192.168.1.0/24`,exitCode:0}:{output:`Scanning local network...

`+h.map(E=>`${E.ip.padEnd(15)} ${E.hostname}`).join(`
`),exitCode:0}}let o=e[0];if(o.includes("/")){let u=this.networkService.scan(o);if(!u.success)return{output:"",exitCode:1,error:u.error};let h=3/r*1e3,B=Math.max(1e3,h);t.onProgress&&B>=1e3&&(yield this.simulateProgress(t.onProgress,B,`Scanning ${o}...`));let E=u.hostsFound.map(V=>{let Se=V.ports.filter(we=>we.status==="open").length;return`${V.ip.padEnd(15)} ${V.hostname} (${Se} ports open)`});return this.verificationService.emitEvent("network_action",{action:"scan",target:o,hostsFound:u.hostsFound.length}),{output:`Scan complete (${(h/1e3).toFixed(1)}s)

Hosts found:
${E.join(`
`)}`,exitCode:0}}let a=this.networkService.getNetworkState().hosts.find(u=>u.ip===o);if(!a)return{output:"",exitCode:1,error:`scan: host ${o} not found`};if(!a.isDiscovered)return{output:"",exitCode:1,error:`scan: host ${o} not discovered yet`};let c=2/r*1e3,d=Math.max(1e3,c);t.onProgress&&d>=1e3&&(yield this.simulateProgress(t.onProgress,d,`Scanning ${o}...`));let C=a.ports.filter(u=>u.status==="open").map(u=>{let h=`${u.number}/tcp   open   ${u.service}`;return s>=2&&u.vulnerability&&(h+=" [VULNERABLE]"),h}).join(`
`),l=`Scan complete (${(c/1e3).toFixed(1)}s)

Host: ${o} (${a.hostname})

Open ports:
${C}`;return s>=3&&(l+=`

Security Level: ${a.securityLevel}`),this.verificationService.emitEvent("network_action",{action:"scan",target:o}),{output:l,exitCode:0}})}simulateProgress(e,t,n){return f(this,null,function*(){let s=t/20;for(let o=0;o<=20;o++){let i=Math.min(100,Math.round(o/20*100)),a=Math.max(0,Math.round(t*(1-o/20)/1e3)),c=a>0?`${n} (${a}s remaining)`:n;e(i,c),o<20&&(yield new Promise(d=>setTimeout(d,s)))}})}probe(e,t){if(e.length<2)return{output:"",exitCode:1,error:"probe: missing arguments (usage: probe <ip> <port>)"};let n=e[0],r=parseInt(e[1]),o=this.networkService.getNetworkState().hosts.find(d=>d.ip===n);if(!o||!o.isDiscovered)return{output:"",exitCode:1,error:`probe: host ${n} not found`};let i=o.ports.find(d=>d.number===r);if(!i||i.status!=="open")return{output:`Port ${r} is closed on ${n}`,exitCode:0};let a=`Probing ${n}:${r}...

`;a+=`Service: ${i.service}
`;let c=i.vulnerability;return c?(a+=`
[!] VULNERABILITY DETECTED: ${c.id}
`,a+=`Description: ${c.description}
`,a+=`Exploitable: Yes
`):a+=`
No known vulnerabilities found.
`,{output:a,exitCode:0}}connect(e,t){if(e.length===0)return{output:"",exitCode:1,error:"ssh: missing ip address"};let n=e[0],r=this.networkService.connect(n);return r.success?(this.verificationService.emitEvent("network_action",{action:"connect",target:n,hostname:r.hostname,accessLevel:r.accessLevel}),{output:`Connected to ${n} (${r.hostname})
Access Level: ${r.accessLevel}`,exitCode:0}):{output:"",exitCode:1,error:`ssh: ${r.error}`}}disconnect(e,t){let n=this.networkService.disconnect();return n.success?{output:`Disconnected from ${n.previousHost}`,exitCode:0}:{output:"",exitCode:1,error:`disconnect: ${n.error}`}}crack(e,t){if(e.length===0)return{output:"",exitCode:1,error:"crack: missing target ip"};let r=this.shopService.getPlayerStats().crackSpeed||1,s=e[0],i=this.networkService.getNetworkState().hosts.find(u=>u.ip===s);if(!i||!i.isDiscovered)return{output:"",exitCode:1,error:`crack: host ${s} not found`};if(i.accessLevel==="root")return{output:`${s} is already compromised`,exitCode:0};let a=Math.floor(Math.random()*3)+2,c=Math.max(1,a/r),d=i.ports.filter(u=>u.vulnerability).length,C=Math.min(.9,.3+(r-1)*.5),l=`Attempting to crack ${s}...
`;if(l+=`Security level: ${d}
`,l+=`Estimated time: ${c.toFixed(1)}s

`,l+=`[\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] 100%

`,d<=2||Math.random()<C){let u=this.networkService.getHost(s);u&&(u.accessLevel="root"),l+=`SUCCESS! Access granted to ${s}
`,l+=`Use 'ssh ${s}' to access the system`,this.verificationService.emitEvent("network_action",{action:"crack",target:s,success:!0});let h=this.missionService.checkObjectiveCompletion("crack",[s],{success:!0,target:s});h.completed&&h.message&&(l+=`

${h.message}`)}else return l+="FAILED! Security too strong. Try using 'exploit' on vulnerable ports.",{output:l,exitCode:1};return{output:l,exitCode:0}}exploit(e,t){if(e.length<2)return{output:"",exitCode:1,error:"exploit: missing arguments (usage: exploit <ip> <port>)"};let n=this.shopService.getPlayerStats(),r=n.exploitPower||1,s=n.detectionReduction||0,o=e[0],i=parseInt(e[1]),a=this.networkService.exploit(o,i);if(!a.success)return{output:"",exitCode:1,error:`exploit: ${a.error}`};let d=Math.max(5,20*(1-s)),C=this.networkService.getNetworkState();C.detectionLevel=Math.min(100,C.detectionLevel+d),this.missionService.checkDetectionFailure();let l=`Exploiting ${a.vulnerability?.name} on ${o}:${i}...
`;l+=`Exploit power: ${(r*100).toFixed(0)}%

`,l+=`[\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] 100%

`,l+=`SUCCESS! Exploited ${o}
`,l+=`${a.accessLevel} access gained!
`,s>0&&(l+=`Detection reduced by ${(s*100).toFixed(0)}%
`),l+=`Use 'ssh ${o}' to access the system`,this.verificationService.emitEvent("network_action",{action:"exploit",target:o,port:i,vulnerability:a.vulnerability?.name,accessLevel:a.accessLevel});let u=e.includes("--backdoor")||e.includes("-b"),h=this.missionService.checkObjectiveCompletion("exploit",[o,i.toString()],{success:!0,target:o,data:{backdoor:u}});return h.completed&&h.message&&(l+=`

${h.message}`),{output:l,exitCode:0}}upload(e,t){let n=this.networkService.getNetworkState();if(!n.currentConnection)return{output:"",exitCode:1,error:"upload: not connected to any host"};if(e.length===0)return{output:"",exitCode:1,error:"upload: missing file name"};let s=this.shopService.getPlayerStats().transferSpeed||1,o=Math.max(.1,1/s).toFixed(1),i=e[0],a=n.currentConnection.to,c=this.missionService.checkObjectiveCompletion("upload",[i],{success:!0,target:a,data:{file:i}}),d=`Uploading ${i} to ${a}... (${o}s)
Upload complete.`;return c.message&&(d+=`
`+c.message),{output:d,exitCode:0}}download(e,t){let n=this.networkService.getNetworkState();if(!n.currentConnection)return{output:"",exitCode:1,error:"download: not connected to any host"};if(e.length===0)return{output:"",exitCode:1,error:"download: missing file name"};let s=this.shopService.getPlayerStats().transferSpeed||1,o=Math.max(.1,1/s).toFixed(1),i=e[0],a=this.fileSystem.resolvePath(i,t.currentDirectory),c=n.currentConnection.to,d=`Downloaded from ${c}
Timestamp: ${new Date().toISOString()}

This is sample data from the remote host.`,C=this.fileSystem.writeFile(a,d),l=this.missionService.checkObjectiveCompletion("download",[i],{success:C,target:c,data:{file:i}});if(!C){let h=`Downloading ${i} from ${c}... (${o}s)
Download complete.
Warning: Could not write to ${a}`;return l.message&&(h+=`
`+l.message),{output:h,exitCode:0}}let u=`Downloading ${i} from ${c}... (${o}s)
Download complete. Saved to ${a}`;return l.message&&(u+=`
`+l.message),{output:u,exitCode:0}}bounce(e,t){return{output:`Bounce connection configured.
All traffic will be routed through proxy nodes.`,exitCode:0}}trace(e,t){let n=this.networkService.getNetworkState(),s=this.shopService.getPlayerStats().traceResistance||0,o=n.detectionLevel,i="Clear";o>75?i="CRITICAL - Trace imminent!":o>50?i="HIGH - Being actively traced":o>25&&(i="MEDIUM - Suspicious activity detected");let a=`Trace status: ${i}
Detection Level: ${o}%`;return s>0&&(a+=`
Trace Resistance: ${(s*100).toFixed(0)}%`,a+=`
Effective Detection: ${Math.max(0,o*(1-s)).toFixed(1)}%`),{output:a,exitCode:0}}sysinfo(e,t){let n=this.networkService.getNetworkState();if(!n.currentConnection){let o=n.hosts.find(a=>a.ip==="127.0.0.1"),i=`System Information
`;return i+=`==================
`,i+=`IP Address: ${o?.ip}
`,i+=`Hostname: ${t.hostname}
`,i+=`User: ${t.user}
`,i+=`OS: WebOS v1.0
`,{output:i,exitCode:0}}let r=n.hosts.find(o=>o.ip===n.currentConnection?.to);if(!r)return{output:"",exitCode:1,error:"sysinfo: connection error"};let s=`Remote System Information
`;return s+=`==========================
`,s+=`IP Address: ${r.ip}
`,s+=`Hostname: ${r.hostname}
`,s+=`Open Ports: ${r.ports.filter(o=>o.status==="open").length}
`,s+=`Vulnerabilities: ${r.ports.filter(o=>o.vulnerability).length}
`,s+=`Security Level: ${r.securityLevel}
`,s+=`Access Level: ${r.accessLevel}
`,s+=`Status: Compromised
`,{output:s,exitCode:0}}transfer(e,t){let n=this.networkService.getNetworkState();if(!n.currentConnection)return{output:"",exitCode:1,error:"transfer: not connected to any host"};if(e.length<1)return{output:"",exitCode:1,error:"transfer: missing amount (usage: transfer <amount>)"};let r=parseFloat(e[0]);if(isNaN(r)||r<=0)return{output:"",exitCode:1,error:"transfer: invalid amount"};let s=n.currentConnection.to,i=this.shopService.getPlayerStats().transferSpeed||1,a=Math.max(.5,2/i).toFixed(1),c=this.missionService.checkObjectiveCompletion("transfer",[r.toString()],{success:!0,target:s,data:{amount:r}}),d=`Transferring $${r.toFixed(2)} from ${s}... (${a}s)
Transfer complete. Funds secured.`;return c.message&&(d+=`
`+c.message),{output:d,exitCode:0}}static \u0275fac=function(t){return new(t||m)};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var j=class m{constructor(e){this.executor=e;this.registerCommands(),this.initializeManPages()}manPages=new Map;registerCommands(){this.executor.registerCommand("help",(e,t)=>this.help(e,t)),this.executor.registerCommand("man",(e,t)=>this.man(e,t))}initializeManPages(){this.manPages.set("ls",{name:"ls",synopsis:"ls [OPTIONS] [PATH]",description:"List directory contents",options:["-l    Use long listing format","-a    Show all files including hidden"],examples:["ls              # List current directory","ls -l           # Long format","ls /home/user   # List specific directory"],seeAlso:["cd","pwd"]}),this.manPages.set("cd",{name:"cd",synopsis:"cd [PATH]",description:"Change the current working directory",examples:["cd /home/user   # Change to absolute path","cd documents    # Change to relative path","cd ..           # Go to parent directory","cd              # Go to home directory"],seeAlso:["pwd","ls"]}),this.manPages.set("pwd",{name:"pwd",synopsis:"pwd",description:"Print the current working directory",seeAlso:["cd","ls"]}),this.manPages.set("cat",{name:"cat",synopsis:"cat FILE [FILE...]",description:"Concatenate and display file contents",examples:["cat file.txt           # Display file","cat file1 file2        # Display multiple files"],seeAlso:["grep","less"]}),this.manPages.set("echo",{name:"echo",synopsis:"echo [TEXT...]",description:"Display a line of text",examples:["echo hello world       # Print text","echo $USER             # Print variable"]}),this.manPages.set("mkdir",{name:"mkdir",synopsis:"mkdir DIRECTORY...",description:"Create directories",examples:["mkdir newdir           # Create directory","mkdir dir1 dir2        # Create multiple"],seeAlso:["rmdir","rm"]}),this.manPages.set("touch",{name:"touch",synopsis:"touch FILE...",description:"Create empty files or update timestamps",examples:["touch newfile.txt      # Create file","touch file1 file2      # Create multiple"],seeAlso:["cat","echo"]}),this.manPages.set("rm",{name:"rm",synopsis:"rm [OPTIONS] FILE...",description:"Remove files or directories",options:["-r, -rf    Remove directories recursively"],examples:["rm file.txt            # Remove file","rm -r directory        # Remove directory"],seeAlso:["rmdir","mv"]}),this.manPages.set("cp",{name:"cp",synopsis:"cp SOURCE DEST",description:"Copy files or directories",examples:["cp file1 file2         # Copy file","cp file /path/to/dir   # Copy to directory"],seeAlso:["mv","rm"]}),this.manPages.set("mv",{name:"mv",synopsis:"mv SOURCE DEST",description:"Move or rename files",examples:["mv old new             # Rename file","mv file /path/to/dir   # Move to directory"],seeAlso:["cp","rm"]}),this.manPages.set("grep",{name:"grep",synopsis:"grep PATTERN [FILE]",description:"Search for patterns in files or input",examples:["grep error log.txt     # Search in file","cat file | grep error  # Search in pipe"],seeAlso:["cat","wc"]}),this.manPages.set("wc",{name:"wc",synopsis:"wc [FILE]",description:"Count lines, words, and characters",examples:["wc file.txt            # Count file","cat file | wc          # Count from pipe"],seeAlso:["grep","cat"]}),this.manPages.set("clear",{name:"clear",synopsis:"clear",description:"Clear the terminal screen"}),this.manPages.set("whoami",{name:"whoami",synopsis:"whoami",description:"Print the current user name"}),this.manPages.set("hostname",{name:"hostname",synopsis:"hostname",description:"Print the system hostname"}),this.manPages.set("date",{name:"date",synopsis:"date",description:"Display the current date and time"}),this.manPages.set("scan",{name:"scan",synopsis:"scan [IP]",description:"Scan network or specific host for open ports",examples:["scan                   # Scan local network","scan 192.168.1.1       # Scan specific host"],seeAlso:["probe","connect"]}),this.manPages.set("probe",{name:"probe",synopsis:"probe IP PORT",description:"Probe a specific port for vulnerabilities",examples:["probe 192.168.1.1 22   # Probe SSH port","probe 10.0.0.5 80      # Probe HTTP port"],seeAlso:["scan","exploit"]}),this.manPages.set("connect",{name:"connect",synopsis:"connect IP",description:"Connect to a compromised system",examples:["connect 192.168.1.1    # Connect to host"],seeAlso:["disconnect","crack"]}),this.manPages.set("disconnect",{name:"disconnect",synopsis:"disconnect",description:"Disconnect from current remote system",seeAlso:["connect"]}),this.manPages.set("crack",{name:"crack",synopsis:"crack IP",description:"Attempt to crack system security (brute force)",examples:["crack 192.168.1.1      # Crack system"],seeAlso:["exploit","connect"]}),this.manPages.set("exploit",{name:"exploit",synopsis:"exploit IP PORT",description:"Exploit a vulnerable service on target system",examples:["exploit 192.168.1.1 21 # Exploit FTP"],seeAlso:["probe","crack"]}),this.manPages.set("upload",{name:"upload",synopsis:"upload FILE",description:"Upload file to connected remote system",examples:["upload backdoor.sh     # Upload file"],seeAlso:["download","connect"]}),this.manPages.set("download",{name:"download",synopsis:"download FILE",description:"Download file from connected remote system",examples:["download data.txt      # Download file"],seeAlso:["upload","connect"]}),this.manPages.set("bounce",{name:"bounce",synopsis:"bounce",description:"Configure bounce/proxy routing for connections",seeAlso:["trace","connect"]}),this.manPages.set("trace",{name:"trace",synopsis:"trace",description:"Check if you are being traced",seeAlso:["bounce"]}),this.manPages.set("sysinfo",{name:"sysinfo",synopsis:"sysinfo",description:"Display system information (local or remote)",seeAlso:["hostname","whoami"]})}help(e,t){if(e.length>0)return this.man(e,t);let n=this.executor.getRegisteredCommands(),r=`WebOS Terminal Help
`;return r+=`===================

`,r+=`Available commands:

`,r+=`File System:
`,r+=`  ls, cd, pwd, cat, mkdir, touch, rm, cp, mv

`,r+=`Text Processing:
`,r+=`  echo, grep, wc

`,r+=`System Info:
`,r+=`  clear, whoami, hostname, date, sysinfo

`,r+=`Hacking Tools:
`,r+=`  scan, probe, connect, disconnect, crack, exploit
`,r+=`  upload, download, bounce, trace

`,r+=`Help:
`,r+=`  help [COMMAND]  - Show this help or command details
`,r+=`  man COMMAND     - Show manual page for command

`,r+=`Use "help <command>" or "man <command>" for more information.
`,r+=`Example: help ls
`,{output:r,exitCode:0}}man(e,t){if(e.length===0)return{output:"",exitCode:1,error:"man: missing command name"};let n=e[0],r=this.manPages.get(n);if(!r)return{output:"",exitCode:1,error:`man: no manual entry for ${n}`};let s=`${r.name.toUpperCase()}(1)

`;if(s+=`NAME
  ${r.name}

`,s+=`SYNOPSIS
  ${r.synopsis}

`,s+=`DESCRIPTION
  ${r.description}

`,r.options&&r.options.length>0){s+=`OPTIONS
`;for(let o of r.options)s+=`  ${o}
`;s+=`
`}if(r.examples&&r.examples.length>0){s+=`EXAMPLES
`;for(let o of r.examples)s+=`  ${o}
`;s+=`
`}return r.seeAlso&&r.seeAlso.length>0&&(s+=`SEE ALSO
  ${r.seeAlso.join(", ")}
`),{output:s,exitCode:0}}static \u0275fac=function(t){return new(t||m)(w(y))};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var H=class m{constructor(e,t){this.executor=e;this.fs=t}complete(e,t){let n=e.split(/\s+/);if(n.length===1&&!e.endsWith(" "))return this.completeCommand(n[0]);let r=e.endsWith(" ")?"":n[n.length-1];return this.completePath(r,t)}completeCommand(e){return{completions:this.executor.getRegisteredCommands().filter(r=>r.startsWith(e)),prefix:e}}completePath(e,t){let n=e.lastIndexOf("/"),r=n>=0?e.substring(0,n+1):"",s=n>=0?e.substring(n+1):e,o=r?this.fs.resolvePath(r,t):t,i=this.fs.listDirectory(o);return i?{completions:i.filter(c=>c.name.startsWith(s)).map(c=>{let d=c.type==="directory"?"/":"";return r+c.name+d}),prefix:e}:{completions:[],prefix:e}}getCompletion(e,t){let n=this.complete(e,t);if(n.completions.length===0)return null;if(n.completions.length===1){let o=n.completions[0],i=e.split(/\s+/);if(i.length===1&&!e.endsWith(" "))return o+" ";let a=e.endsWith(" ")?"":i[i.length-1];return e.substring(0,e.length-a.length)+o}let s=e.split(/\s+/).length===1&&!e.endsWith(" ");return this.getCommonPrefix(n.completions,e,s)}getCommonPrefix(e,t,n){if(e.length===0)return null;let r=t.split(/\s+/),s=t.endsWith(" ")?"":r[r.length-1],o=e[0];for(let i=1;i<e.length;i++){let a=0;for(;a<o.length&&a<e[i].length&&o[a]===e[i][a];)a++;o=o.substring(0,a)}return o.length>s.length?n?o:t.substring(0,t.length-s.length)+o:null}static \u0275fac=function(t){return new(t||m)(w(y),w(I))};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var W=class m{currentUser=v(null);storageService=new ye;isAuthenticated=M(()=>this.currentUser()!==null);user=this.currentUser.asReadonly();constructor(){this.loadSession()}loginAsGuest(){return f(this,null,function*(){let e={username:"guest",isGuest:!0,createdAt:Date.now(),lastLogin:Date.now()};this.currentUser.set(e),yield this.saveSession(e)})}loginWithCredentials(e,t){return f(this,null,function*(){let n=yield this.loadAccounts(),r=n.find(i=>i.username===e);if(!r){let i={username:e,passwordHash:yield this.hashPassword(t),createdAt:Date.now()};n.push(i),yield this.saveAccounts(n);let a={username:e,isGuest:!1,createdAt:i.createdAt,lastLogin:Date.now()};return this.currentUser.set(a),yield this.saveSession(a),{success:!0}}if((yield this.hashPassword(t))!==r.passwordHash)return{success:!1,error:"Invalid password"};let o={username:r.username,isGuest:!1,createdAt:r.createdAt,lastLogin:Date.now()};return this.currentUser.set(o),yield this.saveSession(o),{success:!0}})}logout(){return f(this,null,function*(){this.currentUser.set(null),yield this.storageService.remove("webos.session")})}hashPassword(e){return f(this,null,function*(){let n=new TextEncoder().encode(e),r=yield crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")})}saveSession(e){return f(this,null,function*(){yield this.storageService.set("webos.session",e)})}loadSession(){return f(this,null,function*(){let e=yield this.storageService.get("webos.session");e&&this.currentUser.set(e)})}loadAccounts(){return f(this,null,function*(){return(yield this.storageService.get("webos.accounts"))||[]})}saveAccounts(e){return f(this,null,function*(){yield this.storageService.set("webos.accounts",e)})}static \u0275fac=function(t){return new(t||m)};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};var ke=["outputContainer"],Ie=["commandInput"];function Oe(m,e){if(m&1&&(P(0,"div",9)(1,"div",10),_(2),k(),P(3,"div",11),ne(4,"div",12),k(),P(5,"div",13),_(6),k()()),m&2){let t=G().$implicit;b(2),D(t.progressLabel),b(2),se("width",t.progress,"%"),b(2),ae("",t.progress,"%")}}function Le(m,e){if(m&1&&(P(0,"pre"),_(1),k()),m&2){let t=G().$implicit;b(),D(t.text)}}function Ee(m,e){if(m&1&&(P(0,"div",8),J(1,Oe,7,4,"div",9)(2,Le,2,1,"pre"),k()),m&2){let t=e.$implicit;ie("line-"+t.type),b(),Z(t.type==="progress"?1:2)}}var xe=class m{outputContainer;commandInput;executor=p(y);fs=p(I);unixCommands=p(N);hackingCommands=p(F);helpSystem=p(j);tabCompletion=p(H);authService=p(W);tutorialVerification=p(R);MAX_LINES=1e3;lines=v([{type:"output",text:"WebOS Terminal v1.0",timestamp:new Date},{type:"output",text:'Type "help" for available commands',timestamp:new Date},{type:"output",text:"",timestamp:new Date}]);currentCommand=v("");commandHistory=v([]);historyIndex=v(-1);currentPath=v("/home/user");username=v("user");hostname=v("webos");prompt=M(()=>`${this.username()}@${this.hostname()}:${this.currentPath()}$`);ngOnInit(){let e=this.authService.user();e&&(this.username.set(e.username),this.currentPath.set(`/home/${e.username}`))}ngAfterViewInit(){this.focusInput()}focusInput(){setTimeout(()=>this.commandInput?.nativeElement.focus(),0)}executeCommand(){return f(this,null,function*(){let e=this.currentCommand().trim();if(!e)return;this.lines.update(o=>{let i=[...o,{type:"command",text:`${this.prompt()} ${e}`,timestamp:new Date}];return i.length>this.MAX_LINES?i.slice(-this.MAX_LINES):i}),this.commandHistory.update(o=>[...o,e]),this.historyIndex.set(-1);let t=-1,n={currentDirectory:this.currentPath(),environment:{},user:this.username(),hostname:this.hostname(),onProgress:(o,i)=>{t===-1?this.lines.update(a=>{t=a.length;let c=[...a,{type:"progress",text:i,timestamp:new Date,progress:o,progressLabel:i}];return c.length>this.MAX_LINES?c.slice(-this.MAX_LINES):c}):this.lines.update(a=>{let c=[...a];return c[t]=S(x({},c[t]),{progress:o,progressLabel:i}),c}),this.scrollToBottom()}},r=yield this.executor.execute(e,n);if(t!==-1&&this.lines.update(o=>o.filter((i,a)=>a!==t)),r.output==="CLEAR")this.lines.set([]);else if(r.output.startsWith("CD:")){let o=r.output.substring(3);this.currentPath.set(o)}else(r.output||r.error)&&this.lines.update(o=>{let i=[...o,{type:r.error?"error":"output",text:r.error||r.output,timestamp:new Date}];return i.length>this.MAX_LINES?i.slice(-this.MAX_LINES):i});let s=e.split(" ")[0];this.tutorialVerification.emitEvent("command_executed",{target:s,command:e}),this.currentCommand.set(""),this.scrollToBottom()})}handleKeyDown(e){if(e.key==="ArrowUp"){e.preventDefault();let t=this.commandHistory(),n=this.historyIndex();if(t.length>0){let r=n===-1?t.length-1:Math.max(0,n-1);this.historyIndex.set(r),this.currentCommand.set(t[r])}}else if(e.key==="ArrowDown"){e.preventDefault();let t=this.commandHistory(),n=this.historyIndex();if(n!==-1){let r=n+1;r>=t.length?(this.historyIndex.set(-1),this.currentCommand.set("")):(this.historyIndex.set(r),this.currentCommand.set(t[r]))}}else if(e.key==="Tab"){e.preventDefault();let t=this.tabCompletion.getCompletion(this.currentCommand(),this.currentPath());t&&this.currentCommand.set(t)}else e.key==="l"&&e.ctrlKey&&(e.preventDefault(),this.lines.set([]))}scrollToBottom(){setTimeout(()=>{if(this.outputContainer){let e=this.outputContainer.nativeElement;e.scrollTop=e.scrollHeight}},0)}handleContainerClick(){this.focusInput()}static \u0275fac=function(t){return new(t||m)};static \u0275cmp=Y({type:m,selectors:[["app-terminal"]],viewQuery:function(t,n){if(t&1&&(K(ke,5),K(Ie,5)),t&2){let r;X(r=Q())&&(n.outputContainer=r.first),X(r=Q())&&(n.commandInput=r.first)}},decls:10,vars:2,consts:[["outputContainer",""],["commandInput",""],[1,"terminal",3,"click"],[1,"output-container"],[1,"line",3,"class"],[1,"input-line"],[1,"prompt"],["type","text","autocomplete","off","spellcheck","false",1,"command-input",3,"ngModelChange","keydown","keydown.enter","ngModel"],[1,"line"],[1,"progress-container"],[1,"progress-label"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-percent"]],template:function(t,n){if(t&1){let r=oe();P(0,"div",2),q("click",function(){return A(r),$(n.handleContainerClick())}),P(1,"div",3,0),te(3,Ee,3,3,"div",4,ee),P(5,"div",5)(6,"span",6),_(7),k(),P(8,"input",7,1),de("ngModelChange",function(o){return A(r),me(n.currentCommand,o)||(n.currentCommand=o),$(o)}),q("ngModelChange",function(o){return A(r),$(n.currentCommand.set(o))})("keydown",function(o){return A(r),$(n.handleKeyDown(o))})("keydown.enter",function(){return A(r),$(n.executeCommand())}),k()()()()}t&2&&(b(3),re(n.lines()),b(4),D(n.prompt()),b(),ce("ngModel",n.currentCommand))},dependencies:[le,fe,ue,pe,he],styles:[".terminal[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:#300a24;color:#fff;font-family:Ubuntu Mono,Courier New,monospace;font-size:14px;padding:12px;cursor:text;overflow:hidden}.output-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;overflow-x:hidden;white-space:pre-wrap;word-wrap:break-word}.output-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.output-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a0614}.output-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#5e2750;border-radius:4px}.output-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#7e3770}.line[_ngcontent-%COMP%]{margin-bottom:4px}.line[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;padding:0;font-family:inherit;font-size:inherit;white-space:pre-wrap;word-wrap:break-word}.line.line-command[_ngcontent-%COMP%]{color:#8ae234}.line.line-output[_ngcontent-%COMP%]{color:#fff}.line.line-error[_ngcontent-%COMP%]{color:#ef2929}.line.line-progress[_ngcontent-%COMP%]{color:#fff}.progress-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:4px 0}.progress-label[_ngcontent-%COMP%]{min-width:120px;color:#fff}.progress-bar[_ngcontent-%COMP%]{flex:1;height:16px;background:#1a0614;border-radius:8px;overflow:hidden;border:1px solid #5e2750}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#729fcf,#3465a4);transition:width .3s ease;border-radius:7px}.progress-percent[_ngcontent-%COMP%]{min-width:45px;text-align:right;color:#8ae234;font-weight:700}.input-line[_ngcontent-%COMP%]{display:flex;align-items:baseline;margin-top:4px}.prompt[_ngcontent-%COMP%]{color:#8ae234;margin-right:8px;-webkit-user-select:none;user-select:none;white-space:nowrap}.command-input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;outline:none;color:#fff;font-family:inherit;font-size:inherit;padding:0;caret-color:#fff}.command-input[_ngcontent-%COMP%]::selection{background:#729fcf}"]})};export{U as a,W as b,xe as c};
