import{a as R}from"./chunk-XEXDRVDF.js";import{a as m,aa as p,b as h,c as u,ea as g,ua as d}from"./chunk-OLBKVZNR.js";var v=class l{wallet=d({credits:1e3,bitcoin:0});transactions=d([]);nextTransactionId=1;totalEarned=d(0);totalSpent=d(0);passiveIncomeRate=d(0);lastPassiveIncomeTime=d(Date.now());passiveIncomeInterval;gameDifficulty=d("normal");constructor(){this.loadWallet(),this.loadTransactions(),this.loadTotals(),this.loadPassiveIncome(),this.loadGameDifficulty(),this.startPassiveIncome()}get wallet$(){return this.wallet.asReadonly()}get transactions$(){return this.transactions.asReadonly()}getBalance(t="credits"){return t==="credits"?this.wallet().credits:this.wallet().bitcoin||0}getTotalEarned(){return this.totalEarned()}getTotalSpent(){return this.totalSpent()}getNetWorth(){return this.wallet().credits+(this.wallet().bitcoin||0)*1e3}getTransactionHistory(t){let e=this.transactions();return t?e.slice(0,t):e}getTransactionsByType(t){return this.transactions().filter(e=>e.type===t)}addCredits(t,e,s,i){if(t<=0)throw new Error("Amount must be positive");let n=this.createTransaction(t,e,s,i);return this.wallet.update(r=>h(m({},r),{credits:r.credits+t})),this.totalEarned.update(r=>r+t),this.addTransaction(n),this.saveWallet(),this.saveTotals(),n}deductCredits(t,e,s,i){if(t<=0)return{success:!1,error:"Amount must be positive"};if(this.wallet().credits<t)return{success:!1,error:"Insufficient funds",remainingBalance:this.wallet().credits};let n=this.createTransaction(-t,e,s,i);return this.wallet.update(r=>h(m({},r),{credits:r.credits-t})),this.totalSpent.update(r=>r+t),this.addTransaction(n),this.saveWallet(),this.saveTotals(),{success:!0,transaction:n,remainingBalance:this.wallet().credits}}purchase(t,e,s){return this.deductCredits(t,"purchase",`Purchased ${e}`,s)}sell(t,e,s){return this.addCredits(t,"sale",`Sold ${e}`,s)}addPassiveIncome(t,e,s){return this.addCredits(t,"passive_income",`Passive income from ${e}`,s)}applyPenalty(t,e,s){return this.deductCredits(t,"penalty",`Penalty: ${e}`,s)}refund(t,e,s){return this.addCredits(t,"refund",`Refund: ${e}`,s)}canAfford(t,e="credits"){return this.getBalance(e)>=t}getWalletSnapshot(){return{balance:this.wallet().credits,timestamp:Date.now(),totalEarned:this.totalEarned(),totalSpent:this.totalSpent()}}clearTransactionHistory(){this.transactions.set([]),this.saveTransactions()}resetWallet(t=1e3){this.wallet.set({credits:t,bitcoin:0}),this.totalEarned.set(0),this.totalSpent.set(0),this.transactions.set([]),this.nextTransactionId=1,this.passiveIncomeRate.set(0),this.lastPassiveIncomeTime.set(Date.now()),this.saveWallet(),this.saveTotals(),this.saveTransactions(),this.savePassiveIncome()}getPassiveIncomeRate(){return this.passiveIncomeRate()}setPassiveIncomeRate(t){this.passiveIncomeRate.set(t),this.savePassiveIncome()}getGameDifficulty(){return this.gameDifficulty()}setGameDifficulty(t){this.gameDifficulty.set(t),this.saveGameDifficulty()}getDifficultyMultiplier(){switch(this.gameDifficulty()){case"easy":return .5;case"hard":return 1.5;default:return 1}}startPassiveIncome(){typeof window>"u"||(this.passiveIncomeInterval=window.setInterval(()=>{let t=this.passiveIncomeRate();if(t<=0)return;let e=Date.now(),s=this.lastPassiveIncomeTime(),i=(e-s)/1e3;if(i>=1){let n=Math.floor(t*i);n>0&&(this.addPassiveIncome(n,"passive income generators"),this.lastPassiveIncomeTime.set(e),this.savePassiveIncome())}},1e3))}savePassiveIncome(){try{localStorage.setItem("webos_passive_income",JSON.stringify({rate:this.passiveIncomeRate(),lastTime:this.lastPassiveIncomeTime()}))}catch(t){console.error("Failed to save passive income:",t)}}loadPassiveIncome(){try{let t=localStorage.getItem("webos_passive_income");if(t){let e=JSON.parse(t);this.passiveIncomeRate.set(e.rate||0),this.lastPassiveIncomeTime.set(e.lastTime||Date.now());let s=Date.now(),i=(s-this.lastPassiveIncomeTime())/1e3,n=this.passiveIncomeRate();if(n>0&&i>0){let r=Math.floor(n*i);r>0&&this.addPassiveIncome(r,"passive income (offline)"),this.lastPassiveIncomeTime.set(s),this.savePassiveIncome()}}}catch(t){console.error("Failed to load passive income:",t)}}createTransaction(t,e,s,i){return{id:`tx_${this.nextTransactionId++}`,type:e,amount:t,description:s,timestamp:Date.now(),metadata:i}}addTransaction(t){this.transactions.update(e=>[t,...e]),this.saveTransactions()}saveWallet(){try{localStorage.setItem("webos_wallet",JSON.stringify(this.wallet()))}catch(t){console.error("Failed to save wallet:",t)}}loadWallet(){try{let t=localStorage.getItem("webos_wallet");if(t){let e=JSON.parse(t);this.wallet.set(e)}}catch(t){console.error("Failed to load wallet:",t)}}saveTransactions(){try{let t=this.transactions().slice(0,500);if(localStorage.setItem("webos_transactions",JSON.stringify(t)),t.length>0){let e=Math.max(...t.map(s=>parseInt(s.id.split("_")[1])||0));this.nextTransactionId=e+1}}catch(t){console.error("Failed to save transactions:",t)}}loadTransactions(){try{let t=localStorage.getItem("webos_transactions");if(t){let e=JSON.parse(t);if(this.transactions.set(e),e.length>0){let s=Math.max(...e.map(i=>parseInt(i.id.split("_")[1])||0));this.nextTransactionId=s+1}}}catch(t){console.error("Failed to load transactions:",t)}}saveTotals(){try{localStorage.setItem("webos_economy_totals",JSON.stringify({totalEarned:this.totalEarned(),totalSpent:this.totalSpent()}))}catch(t){console.error("Failed to save totals:",t)}}loadTotals(){try{let t=localStorage.getItem("webos_economy_totals");if(t){let e=JSON.parse(t);this.totalEarned.set(e.totalEarned||0),this.totalSpent.set(e.totalSpent||0)}}catch(t){console.error("Failed to load totals:",t)}}saveGameDifficulty(){try{localStorage.setItem("webos_game_difficulty",this.gameDifficulty())}catch(t){console.error("Failed to save game difficulty:",t)}}loadGameDifficulty(){try{let t=localStorage.getItem("webos_game_difficulty");t&&(t==="easy"||t==="normal"||t==="hard")&&this.gameDifficulty.set(t)}catch(t){console.error("Failed to load game difficulty:",t)}}static \u0275fac=function(e){return new(e||l)};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})};var b=(a=>(a.HACK_SERVER="hack_server",a.STEAL_FILE="steal_file",a.UPLOAD_FILE="upload_file",a.DELETE_FILE="delete_file",a.SCAN_NETWORK="scan_network",a.CRACK_PASSWORD="crack_password",a.INSTALL_BACKDOOR="install_backdoor",a.CLEAR_LOGS="clear_logs",a.TRANSFER_FUNDS="transfer_funds",a))(b||{});var T=class l{notificationService=g(R);economyService=g(v);missions=d([]);nextMissionId=1;playerReputations=d([]);playerStats=d({missionsCompleted:0,missionsFailed:0,totalMissionsAttempted:0});missionHistory=d([]);gameDifficulty=d("normal");CLIENT_NAMES=["Anonymous Client","CyberCorp","DataSecure Inc","NetGuard Systems","InfoTech Solutions","SecureNet Corp","TechVentures","Digital Dynamics","CyberSolutions Ltd","NetSafe Technologies"];FACTIONS=[{id:"corporate",name:"Corporate",description:"Multinational corporations seeking competitive advantage",color:"#0066cc",relationships:new Map([["underground","neutral"],["government","ally"],["activist","hostile"],["criminal","hostile"],["security","ally"]])},{id:"underground",name:"Underground",description:"Hacktivists and independent operatives",color:"#00aa00",relationships:new Map([["corporate","neutral"],["government","hostile"],["activist","ally"],["criminal","neutral"],["security","hostile"]])},{id:"government",name:"Government",description:"State-sponsored intelligence agencies",color:"#cc0000",relationships:new Map([["corporate","ally"],["underground","hostile"],["activist","hostile"],["criminal","hostile"],["security","ally"]])},{id:"activist",name:"Activist",description:"Freedom fighters and whistleblowers",color:"#ff9900",relationships:new Map([["corporate","hostile"],["underground","ally"],["government","hostile"],["criminal","neutral"],["security","hostile"]])},{id:"criminal",name:"Criminal",description:"Organized crime and black market operators",color:"#990099",relationships:new Map([["corporate","hostile"],["underground","neutral"],["government","hostile"],["activist","neutral"],["security","hostile"]])},{id:"security",name:"Security",description:"Private security firms and defensive contractors",color:"#0099cc",relationships:new Map([["corporate","ally"],["underground","hostile"],["government","ally"],["activist","hostile"],["criminal","hostile"]])}];REPUTATION_THRESHOLDS=[{level:"Hated",minReputation:-1e3,unlocks:[]},{level:"Hostile",minReputation:-500,unlocks:[]},{level:"Unfriendly",minReputation:-100,unlocks:[]},{level:"Neutral",minReputation:0,unlocks:[]},{level:"Friendly",minReputation:100,unlocks:["tier2_missions"]},{level:"Honored",minReputation:500,unlocks:["tier3_missions","faction_gear"]},{level:"Revered",minReputation:1e3,unlocks:["tier4_missions","faction_exclusive"]},{level:"Exalted",minReputation:2500,unlocks:["tier5_missions","faction_elite"]}];constructor(){this.loadMissions(),this.loadReputations(),this.initializeReputations(),this.loadPlayerStats(),this.loadMissionHistory(),this.loadGameDifficulty()}get missions$(){return this.missions.asReadonly()}get playerStats$(){return this.playerStats.asReadonly()}get missionHistory$(){return this.missionHistory.asReadonly()}getGameDifficulty(){return this.gameDifficulty()}setGameDifficulty(t){this.gameDifficulty.set(t),this.saveGameDifficulty()}getDifficultyMultiplier(){switch(this.gameDifficulty()){case"easy":return .5;case"hard":return 1.5;default:return 1}}getPlayerStats(){return this.playerStats()}getCredits(){return this.economyService.getBalance()}getMissionHistory(){return this.missionHistory()}getMissionStatistics(){let t=this.playerStats(),e=t.totalMissionsAttempted,s=t.missionsCompleted,i=t.missionsFailed,n=e>0?s/e*100:0;return{completed:s,failed:i,total:e,successRate:n}}getMission(t){return this.missions().find(e=>e.id===t)}getAvailableMissions(){return this.missions().filter(t=>t.status==="available")}getActiveMissions(){return this.missions().filter(t=>t.status==="active")}getCompletedMissions(){return this.missions().filter(t=>t.status==="completed")}generateMission(t){let e={minDifficulty:"easy",maxDifficulty:"hard",objectiveCount:1,timeLimitMultiplier:1,rewardMultiplier:1},s=m(m({},e),t),i=this.randomDifficulty(s.minDifficulty,s.maxDifficulty),n=Math.max(1,s.objectiveCount),r=this.generateObjectives(n,i),o=this.calculateReward(r,i,s.rewardMultiplier),c=this.calculateTimeLimit(r,i,s.timeLimitMultiplier),a={id:`mission_${this.nextMissionId++}`,title:this.generateMissionTitle(r[0].type,i),description:this.generateMissionDescription(r),difficulty:i,status:"available",objectives:r,reward:o,timeLimit:c,expiresAt:Date.now()+1440*60*1e3,clientName:this.randomElement(this.CLIENT_NAMES),clientFaction:this.randomElement(this.FACTIONS).id,targetNetwork:this.generateTargetNetwork(),stealthRequired:Math.random()<.3,consequences:{success:"Payment will be transferred upon completion.",failure:"No payment will be issued. Reputation loss may occur."}};return this.addMission(a),a}acceptMission(t){let e=this.getMission(t);return!e||e.status!=="available"?!1:(this.updateMission(t,{status:"active",startTime:Date.now()}),this.saveMissions(),!0)}completeMission(t){let e=this.getMission(t);if(!e||e.status!=="active"||!e.objectives.every(n=>n.completed))return null;let i=Date.now();return this.updateMission(t,{status:"completed",completedAt:i}),e.clientFaction&&this.updateReputation(e.clientFaction,e.reward.reputation||0,e),this.distributeReward(e.reward),this.updateStats({missionsCompleted:1,totalMissionsAttempted:1}),this.addToHistory({missionId:e.id,title:e.title,difficulty:e.difficulty,status:"completed",reward:e.reward,completedAt:i,clientFaction:e.clientFaction}),this.saveMissions(),e.reward}failMission(t,e){let s=this.getMission(t);if(!s||s.status!=="active")return!1;let i=Date.now();if(this.updateMission(t,{status:"failed",failedAt:i}),s.clientFaction){let n=Math.floor((s.reward.reputation||0)*.5);this.updateReputation(s.clientFaction,-n,s)}return this.updateStats({missionsFailed:1,totalMissionsAttempted:1}),this.addToHistory({missionId:s.id,title:s.title,difficulty:s.difficulty,status:"failed",reward:s.reward,failedAt:i,clientFaction:s.clientFaction}),this.saveMissions(),!0}updateObjectiveProgress(t,e,s){let i=this.getMission(t);if(!i||i.status!=="active")return!1;let n=i.objectives.find(o=>o.id===e);return n?(n.progress=s,n.maxProgress&&s>=n.maxProgress&&(n.completed=!0),this.updateMission(t,{objectives:i.objectives}),this.saveMissions(),i.objectives.every(o=>o.completed)&&this.completeMission(t),!0):!1}completeObjective(t,e){let s=this.getMission(t);if(!s||s.status!=="active")return!1;let i=s.objectives.find(r=>r.id===e);return i?(i.completed=!0,this.updateMission(t,{objectives:s.objectives}),this.saveMissions(),s.objectives.every(r=>r.completed)&&this.completeMission(t),!0):!1}checkExpiredMissions(){let t=Date.now(),e=this.missions().filter(i=>i.status==="available"&&i.expiresAt&&i.expiresAt<t);e.forEach(i=>{this.updateMission(i.id,{status:"expired"})});let s=this.missions().filter(i=>i.status==="active"&&i.timeLimit&&i.startTime&&Date.now()-i.startTime>i.timeLimit);s.forEach(i=>{this.failMission(i.id,"Time limit exceeded")}),(e.length>0||s.length>0)&&this.saveMissions()}clearCompletedMissions(){this.missions.update(t=>t.filter(e=>e.status!=="completed"&&e.status!=="failed")),this.saveMissions()}clearAllMissions(){this.missions.set([]),this.saveMissions()}deliverMissionsToEmail(t=3){let e=this.getPlayerLevel();return this.generateContractBatch(e,t)}generateContractBatch(t,e=3){let s=this.getConfigForPlayerLevel(t),i=[];for(let n=0;n<e;n++){let r=this.randomizeConfig(s,n);i.push(this.generateMission(r))}return i}getPlayerLevel(){let t=this.getCompletedMissions();if(t.length===0)return 1;let e=t.reduce((s,i)=>s+(i.reward.reputation||0),0);return Math.floor(e/100)+1}getRecommendedDifficulty(t){return t<=2?"easy":t<=5?"medium":t<=10?"hard":"expert"}getConfigForPlayerLevel(t){let e=this.getRecommendedDifficulty(t),s=Math.min(1+Math.floor(t/3),4),i=1+t*.1,n=Math.max(.5,1.5-t*.05),r="easy",o=e;return t>=3&&(r="medium"),t>=6&&(r="hard"),{minDifficulty:r,maxDifficulty:o,objectiveCount:s,timeLimitMultiplier:n,rewardMultiplier:i}}randomizeConfig(t,e){let s=Math.floor(Math.random()*3)-1,i=Math.max(1,(t.objectiveCount||1)+s),n=.8+Math.random()*.4,r=(t.rewardMultiplier||1)*n,o=.9+Math.random()*.2,c=(t.timeLimitMultiplier||1)*o;return{minDifficulty:t.minDifficulty,maxDifficulty:t.maxDifficulty,objectiveCount:i,rewardMultiplier:r,timeLimitMultiplier:c}}addMission(t){this.missions.update(e=>[...e,t]),this.saveMissions()}updateMission(t,e){this.missions.update(s=>s.map(i=>i.id===t?m(m({},i),e):i))}generateObjectives(t,e){let s=Object.values(b),i=[];for(let n=0;n<t;n++){let r=this.randomElement(s),o={id:`obj_${n+1}`,type:r,description:this.generateObjectiveDescription(r,e),completed:!1};(r==="steal_file"||r==="delete_file")&&(o.targetFile=this.generateTargetFile()),r==="scan_network"&&(o.maxProgress=this.getDifficultyValue(e,3,5,10,15)),r==="transfer_funds"&&(o.targetAmount=this.getDifficultyValue(e,1e3,5e3,1e4,5e4)),i.push(o)}return i}generateObjectiveDescription(t,e){return{hack_server:`Gain ${this.getDifficultyAccess(e)} access to target server`,steal_file:"Download sensitive file from target system",upload_file:"Upload malware to target server",delete_file:"Delete evidence from target system",scan_network:"Scan and map the target network",crack_password:"Crack administrator password",install_backdoor:"Install persistent backdoor access",clear_logs:"Clear all traces from system logs",transfer_funds:"Transfer funds from target account"}[t]}generateMissionTitle(t,e){let i={hack_server:["Server Infiltration","System Breach","Network Penetration"],steal_file:["Data Extraction","File Theft","Document Recovery"],upload_file:["Malware Deployment","Payload Installation","Trojan Upload"],delete_file:["Evidence Removal","File Deletion","Data Sanitization"],scan_network:["Network Reconnaissance","Infrastructure Mapping","System Discovery"],crack_password:["Password Breach","Credential Theft","Access Recovery"],install_backdoor:["Backdoor Installation","Persistent Access","Remote Control"],clear_logs:["Log Clearing","Trace Removal","Evidence Cleanup"],transfer_funds:["Fund Transfer","Financial Extraction","Account Drain"]}[t];return`${this.randomElement(i)} [${e.toUpperCase()}]`}generateMissionDescription(t){let e=["A client requires your specialized services for a sensitive operation.","We need someone with your skills for a discrete task.","Time-sensitive job opportunity. Discretion guaranteed.","High-value target requires professional handling.","Corporate espionage contract. Handle with care."];return this.randomElement(e)}generateTargetNetwork(){let t=["192.168.1.0/24","10.0.0.0/24","172.16.0.0/24","192.168.100.0/24","10.10.0.0/24"];return this.randomElement(t)}generateTargetFile(){let t=["/data/financial_records.db","/home/admin/passwords.txt","/var/logs/access.log","/root/confidential.doc","/etc/shadow","/data/customer_database.sql","/home/user/secrets.txt"];return this.randomElement(t)}calculateReward(t,e,s){let i=this.getDifficultyValue(e,1e3,2500,5e3,1e4),n=(t.length-1)*500,r=this.getDifficultyMultiplier(),o=Math.floor((i+n)*s*r),c=Math.floor(this.getDifficultyValue(e,10,25,50,100)*r);return{credits:o,reputation:c}}calculateTimeLimit(t,e,s){let i=this.getDifficultyValue(e,18e5,12e5,9e5,6e5),n=t.length*3e5,r=this.getDifficultyMultiplier(),o=r===.5?1.5:r===1.5?.75:1;return Math.floor((i+n)*s*o)}getDifficultyValue(t,e,s,i,n){switch(t){case"easy":return e;case"medium":return s;case"hard":return i;case"expert":return n}}getDifficultyAccess(t){switch(t){case"easy":return"user";case"medium":return"admin";case"hard":return"root";case"expert":return"root"}}randomDifficulty(t,e){let s=["easy","medium","hard","expert"],i=s.indexOf(t),n=s.indexOf(e),r=Math.floor(Math.random()*(n-i+1))+i;return s[r]}randomElement(t){return t[Math.floor(Math.random()*t.length)]}saveMissions(){try{localStorage.setItem("webos_missions",JSON.stringify(this.missions()))}catch(t){console.error("Failed to save missions:",t)}}loadMissions(){try{let t=localStorage.getItem("webos_missions");if(t){let e=JSON.parse(t);this.missions.set(e),this.nextMissionId=Math.max(...e.map(s=>parseInt(s.id.split("_")[1])||0))+1}}catch(t){console.error("Failed to load missions:",t)}}getReputation(t){return this.playerReputations().find(e=>e.factionId===t)}getAllReputations(){return this.playerReputations()}getReputationLevel(t){let e=this.getReputation(t);if(!e)return"Neutral";for(let s=this.REPUTATION_THRESHOLDS.length-1;s>=0;s--){let i=this.REPUTATION_THRESHOLDS[s];if(e.reputation>=i.minReputation)return i.level}return"Neutral"}getUnlockedFeatures(t){let e=this.getReputation(t);if(!e)return[];let s=[];for(let i of this.REPUTATION_THRESHOLDS)e.reputation>=i.minReputation&&i.unlocks&&s.push(...i.unlocks);return s}getFaction(t){return this.FACTIONS.find(e=>e.id===t)}getAllFactions(){return this.FACTIONS}getFactionRelationship(t,e){let s=this.getFaction(t);return s?s.relationships.get(e)||"neutral":"neutral"}updateReputation(t,e,s){let i=this.getReputation(t);if(!i)return;let n=this.getReputationLevel(t);i.reputation+=e,i.level=this.getReputationLevel(t),this.applyRelationshipEffects(t,e,s),this.playerReputations.update(r=>r.map(o=>o.factionId===t?i:o)),this.saveReputations()}applyRelationshipEffects(t,e,s){let i=this.getFaction(t);if(i)for(let[n,r]of i.relationships.entries()){let o=0;switch(r){case"ally":o=.25;break;case"hostile":o=-.5;break;case"neutral":o=0;break}if(o!==0){let c=this.getReputation(n);if(c){let a=Math.floor(e*o);c.reputation+=a,c.level=this.getReputationLevel(n),this.playerReputations.update(f=>f.map(M=>M.factionId===n?c:M))}}}}initializeReputations(){if(this.playerReputations().length===0){let e=this.FACTIONS.map(s=>({factionId:s.id,reputation:0,level:"Neutral"}));this.playerReputations.set(e),this.saveReputations()}}saveReputations(){try{localStorage.setItem("webos_reputations",JSON.stringify(this.playerReputations()))}catch(t){console.error("Failed to save reputations:",t)}}loadReputations(){try{let t=localStorage.getItem("webos_reputations");if(t){let e=JSON.parse(t);this.playerReputations.set(e)}}catch(t){console.error("Failed to load reputations:",t)}}distributeReward(t){this.economyService.addCredits(t.credits,"mission_reward",`Mission reward: ${t.credits} credits`,{reputation:t.reputation}),this.notificationService.success("Mission Completed!",`Earned ${t.credits} credits${t.reputation?` and ${t.reputation} reputation`:""}`)}updateStats(t){let e=this.playerStats();this.playerStats.set(h(m({},e),{missionsCompleted:e.missionsCompleted+(t.missionsCompleted||0),missionsFailed:e.missionsFailed+(t.missionsFailed||0),totalMissionsAttempted:e.totalMissionsAttempted+(t.totalMissionsAttempted||0)})),this.savePlayerStats()}addToHistory(t){this.missionHistory.update(e=>[t,...e]),this.saveMissionHistory()}savePlayerStats(){try{localStorage.setItem("webos_player_stats",JSON.stringify(this.playerStats()))}catch(t){console.error("Failed to save player stats:",t)}}loadPlayerStats(){try{let t=localStorage.getItem("webos_player_stats");if(t){let e=JSON.parse(t),s={missionsCompleted:e.missionsCompleted||0,missionsFailed:e.missionsFailed||0,totalMissionsAttempted:e.totalMissionsAttempted||0};this.playerStats.set(s),("credits"in e||"totalCreditsEarned"in e)&&this.savePlayerStats()}}catch(t){console.error("Failed to load player stats:",t)}}saveMissionHistory(){try{let t=this.missionHistory().slice(0,100);localStorage.setItem("webos_mission_history",JSON.stringify(t))}catch(t){console.error("Failed to save mission history:",t)}}loadMissionHistory(){try{let t=localStorage.getItem("webos_mission_history");if(t){let e=JSON.parse(t);this.missionHistory.set(e)}}catch(t){console.error("Failed to load mission history:",t)}}saveGameDifficulty(){try{localStorage.setItem("webos_game_difficulty",this.gameDifficulty())}catch(t){console.error("Failed to save game difficulty:",t)}}loadGameDifficulty(){try{let t=localStorage.getItem("webos_game_difficulty");t&&(t==="easy"||t==="normal"||t==="hard")&&this.gameDifficulty.set(t)}catch(t){console.error("Failed to load game difficulty:",t)}}static \u0275fac=function(e){return new(e||l)};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})};var w=class l{adapter;constructor(){this.adapter=this.initializeAdapter()}initializeAdapter(){return this.isIndexedDBSupported()?new S:new E}isIndexedDBSupported(){return typeof indexedDB<"u"}get(t){return u(this,null,function*(){return this.adapter.get(t)})}set(t,e){return u(this,null,function*(){return this.adapter.set(t,e)})}remove(t){return u(this,null,function*(){return this.adapter.remove(t)})}clear(){return u(this,null,function*(){return this.adapter.clear()})}keys(){return u(this,null,function*(){return this.adapter.keys()})}static \u0275fac=function(e){return new(e||l)};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})},S=class{DB_NAME="webos-db";STORE_NAME="storage";DB_VERSION=1;db=null;getDB(){return u(this,null,function*(){return this.db?this.db:new Promise((t,e)=>{let s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>e(s.error),s.onsuccess=()=>{this.db=s.result,t(s.result)},s.onupgradeneeded=i=>{let n=i.target.result;n.objectStoreNames.contains(this.STORE_NAME)||n.createObjectStore(this.STORE_NAME)}})})}get(t){return u(this,null,function*(){let e=yield this.getDB();return new Promise((s,i)=>{let o=e.transaction(this.STORE_NAME,"readonly").objectStore(this.STORE_NAME).get(t);o.onsuccess=()=>s(o.result??null),o.onerror=()=>i(o.error)})})}set(t,e){return u(this,null,function*(){let s=yield this.getDB();return new Promise((i,n)=>{let c=s.transaction(this.STORE_NAME,"readwrite").objectStore(this.STORE_NAME).put(e,t);c.onsuccess=()=>i(),c.onerror=()=>n(c.error)})})}remove(t){return u(this,null,function*(){let e=yield this.getDB();return new Promise((s,i)=>{let o=e.transaction(this.STORE_NAME,"readwrite").objectStore(this.STORE_NAME).delete(t);o.onsuccess=()=>s(),o.onerror=()=>i(o.error)})})}clear(){return u(this,null,function*(){let t=yield this.getDB();return new Promise((e,s)=>{let r=t.transaction(this.STORE_NAME,"readwrite").objectStore(this.STORE_NAME).clear();r.onsuccess=()=>e(),r.onerror=()=>s(r.error)})})}keys(){return u(this,null,function*(){let t=yield this.getDB();return new Promise((e,s)=>{let r=t.transaction(this.STORE_NAME,"readonly").objectStore(this.STORE_NAME).getAllKeys();r.onsuccess=()=>e(r.result),r.onerror=()=>s(r.error)})})}},E=class{get(t){return u(this,null,function*(){let e=localStorage.getItem(t);if(e===null)return null;try{return JSON.parse(e)}catch{return e}})}set(t,e){return u(this,null,function*(){localStorage.setItem(t,JSON.stringify(e))})}remove(t){return u(this,null,function*(){localStorage.removeItem(t)})}clear(){return u(this,null,function*(){localStorage.clear()})}keys(){return u(this,null,function*(){return Object.keys(localStorage)})}};var D=(s=>(s.NONE="none",s.USER="user",s.ROOT="root",s))(D||{});var I=class l{state={hosts:{},connections:[],currentHost:"127.0.0.1",scanHistory:[],exploitHistory:[],playerIp:"127.0.0.1",detectionLevel:0};stateSignal=d(this.state);constructor(){this.initializeNetwork(),this.updateSignal()}updateSignal(){this.stateSignal.set(m({},this.state))}get state$(){return this.stateSignal.asReadonly()}initializeNetwork(){let t={id:"player",ip:"127.0.0.1",hostname:"localhost",type:"player",ports:[{number:22,status:"open",service:"ssh"}],accessLevel:"root",isDiscovered:!0,isOnline:!0,securityLevel:5,coordinates:{x:400,y:300}},e=[{id:"target1",ip:"192.168.1.100",hostname:"corp-server-01",type:"server",ports:[{number:21,status:"open",service:"ftp",vulnerability:{id:"ftp-anon",name:"Anonymous FTP",description:"FTP server allows anonymous login",exploitCommand:"exploit ftp-anon 192.168.1.100",successRate:.9,detectability:.2}},{number:22,status:"closed",service:"ssh"},{number:80,status:"open",service:"http"}],accessLevel:"none",isDiscovered:!1,isOnline:!0,securityLevel:3,coordinates:{x:600,y:200},fileSystem:{files:["data.txt","passwords.db","readme.md"],directories:["logs","config","backup"]}},{id:"target2",ip:"192.168.1.150",hostname:"dev-workstation",type:"workstation",ports:[{number:22,status:"open",service:"ssh",vulnerability:{id:"ssh-weak",name:"Weak SSH Credentials",description:"SSH server uses weak default credentials",exploitCommand:"exploit ssh-weak 192.168.1.150",requiredTools:["hydra"],successRate:.7,detectability:.5}},{number:3389,status:"open",service:"rdp"}],accessLevel:"none",isDiscovered:!1,isOnline:!0,securityLevel:2,coordinates:{x:700,y:400},fileSystem:{files:["notes.txt","credentials.txt"],directories:["documents","downloads"]}},{id:"target3",ip:"10.0.0.1",hostname:"gateway-router",type:"router",ports:[{number:23,status:"open",service:"telnet",vulnerability:{id:"telnet-default",name:"Default Telnet Password",description:"Router uses factory default credentials",exploitCommand:"exploit telnet-default 10.0.0.1",successRate:.95,detectability:.3}},{number:80,status:"open",service:"http"}],accessLevel:"none",isDiscovered:!1,isOnline:!0,securityLevel:1,coordinates:{x:500,y:150}}];this.state.hosts[t.ip]=t,e.forEach(s=>{this.state.hosts[s.ip]=s})}getState(){return m({},this.state)}getNetworkState(){return{hosts:Object.values(this.state.hosts),connections:this.state.connections,currentConnection:this.getActiveConnection(),detectionLevel:this.getDetectionLevel()}}getCurrentHost(){return this.state.hosts[this.state.currentHost]}getHost(t){return this.state.hosts[t]}getAllHosts(){return Object.values(this.state.hosts)}getDiscoveredHosts(){return Object.values(this.state.hosts).filter(t=>t.isDiscovered)}scan(t,e="quick"){if(t.includes("/")){let o=t.split("/")[0],c=o.substring(0,o.lastIndexOf(".")),a=Object.values(this.state.hosts).filter(f=>f.ip.startsWith(c)&&f.ip!==this.state.playerIp);return a.forEach(f=>{f.isDiscovered=!0}),this.state.detectionLevel+=e==="stealth"?.5:e==="full"?2:1,this.updateSignal(),{success:!0,hostsFound:a}}let s=this.state.hosts[t];if(!s||!s.isOnline)return{success:!1,error:`Host ${t} not found or offline`,hostsFound:[]};s.isDiscovered=!0;let i=s.ports.filter(o=>o.status==="open"),n=i.filter(o=>o.vulnerability).map(o=>o.vulnerability),r={host:t,timestamp:Date.now(),openPorts:i,vulnerabilities:n,scanType:e,osGuess:s.type==="server"?"Linux":"Windows"};return this.state.scanHistory.push(r),e==="full"?this.state.detectionLevel+=2:e==="stealth"?this.state.detectionLevel+=.5:this.state.detectionLevel+=1,this.updateSignal(),{success:!0,hostsFound:[s]}}exploit(t,e){let s=this.state.hosts[t];if(!s)return{success:!1,error:"Host not found"};let i;if(typeof e=="number"?i=s.ports.find(a=>a.number===e&&a.vulnerability):i=s.ports.find(a=>a.vulnerability?.id===e),!i?.vulnerability)return{success:!1,error:"No vulnerability found on this port"};let n=i.vulnerability,r=Math.random()<n.successRate,o=Math.random()<n.detectability;o&&(this.state.detectionLevel+=10);let c={success:r,message:r?`Successfully exploited ${n.name} on ${t}`:`Exploit failed for ${n.name} on ${t}`,accessLevel:r?"user":void 0,detected:o,loot:r&&s.fileSystem?s.fileSystem.files.slice(0,2):void 0};return r&&(s.accessLevel="user"),this.state.exploitHistory.push(c),this.updateSignal(),{success:r,error:r?void 0:`Exploit failed for ${n.name}`,vulnerability:n,accessLevel:c.accessLevel}}connect(t){let e=this.state.hosts[t];if(!e||!e.isOnline)return{success:!1,error:"Host not found or offline"};if(e.accessLevel==="none")return{success:!1,error:"Access denied - no credentials"};let s={from:this.state.currentHost,to:t,timestamp:Date.now(),status:"active"};return this.state.connections.filter(i=>i.status==="active").forEach(i=>{i.status="inactive"}),this.state.connections.push(s),this.state.currentHost=t,this.updateSignal(),{success:!0,hostname:e.hostname,accessLevel:e.accessLevel}}disconnect(){if(this.state.currentHost===this.state.playerIp)return{success:!1,error:"Not connected to any remote host"};let t=this.state.currentHost,e=this.state.hosts[t];return this.state.connections.filter(s=>s.status==="active").forEach(s=>{s.status="inactive"}),this.state.currentHost=this.state.playerIp,this.updateSignal(),{success:!0,previousHost:e?.hostname||t}}getActiveConnection(){return this.state.connections.find(t=>t.status==="active")}elevateAccess(t){let e=this.state.hosts[t];return!e||e.accessLevel!=="user"?!1:Math.random()<.3?(e.accessLevel="root",this.state.detectionLevel+=5,!0):!1}getDetectionLevel(){return Math.min(100,this.state.detectionLevel)}resetDetection(){this.state.detectionLevel=0}serialize(){return JSON.stringify(this.state)}deserialize(t){try{let e=JSON.parse(t);this.state=e,this.updateSignal()}catch(e){console.error("Failed to deserialize network state:",e),this.state={hosts:{},connections:[],currentHost:"127.0.0.1",scanHistory:[],exploitHistory:[],playerIp:"127.0.0.1",detectionLevel:0},this.initializeNetwork(),this.updateSignal()}}reset(){this.state={hosts:{},connections:[],currentHost:"127.0.0.1",scanHistory:[],exploitHistory:[],playerIp:"127.0.0.1",detectionLevel:0},this.initializeNetwork(),this.updateSignal()}static \u0275fac=function(e){return new(e||l)};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})};export{v as a,T as b,w as c,D as d,I as e};
